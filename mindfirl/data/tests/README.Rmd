---
title: "README"
author: "Gurudev Ilangovan"
date: "10/29/2018"
output: 
  github_document: 
    toc: yes
---

- The test samples can be found in this directory. 
- The test files are named test\_{test-no}\_sample\_{file-no}.csv. File number corresponds to the two files to be uploaded. There is also a test\_{test-no}\_sample\_pair.csv that has the groups from which the individual files were made. 
- In a way, the pair file represents the ideal grouping but such a grouping cannot be achived by exact matching methods. 
- However, we try to get all the groups by repeatedly blocking.
- This file would also contain the groups for various blocking variables. 

# Samples

## Sample 2

### Raw (ideal: 5 group comparisons, 10 pairs)

In these 5 group comparisons, the first group (id-146) alone may not refer to the same entity.

ID,voter_reg_num,first_name,last_name,dob,sex,race <br/>
146_a,1000153844,KEVIN,RANDALL,08/31/1951,M,W <br/>
146_b,1001039939,KEVIN,PURCELL,08/31/1951,M, <br/>

223_a,1063209897,BAKRI,ABDEL-AZIZ SR,03/26/1965,M,O <br/>
223_b,1100128569,BAKRI,ABDEL-AZIZ SR,03/26/1915,M,O <br/>
223_bd,1100128569,BAKER,ABDEL-AZIZ SR,04/08/1982,M,O <br/>

333_a,,MARY DELL,BAKER,04/08/1928,F,W <br/>
333_b,1000295504,BAKER,MARY DELL,04/08/1928,F,W <br/>
333_bd,1000295504,BAKER,MARY DELL,04/08/1982,F,W <br/>

358_a,,W RICHARD,ARCILESI JR,01/30/1957,M,W <br/>
358_b,1015248678,WILLIAM,ARCILESI JR,01/30/1917,M,W <br/>

87_a,1075008084,ERNIE,SHORE III,12/17/1959,M,W <br/>
87_b,1705008084,ERNEST,SHORE III,12/17/1959,M,W <br/>
87_bd,1705008084,ERNEST,SHORE,12/17/1959,M,W <br/>

### voter_reg_num (correct: 3/5 groups, 3/10 pairs | wrong: 1 pair)

223_b,1100128569,BAKRI,ABDEL-AZIZ SR,03/26/1915,M,O <br/>
223_bd,1100128569,BAKER,ABDEL-AZIZ SR,04/08/1982,M,O <br/>

333_b,1000295504,BAKER,MARY DELL,04/08/1928,F,W <br/>
333_bd,1000295504,BAKER,MARY DELL,04/08/1982,F,W <br/>

333_a,,MARY DELL,BAKER,04/08/1928,F,W <br/>
358_a,,W RICHARD,ARCILESI JR,01/30/1957,M,W <br/>

87_b,1705008084,ERNEST,SHORE III,12/17/1959,M,W <br/>
87_bd,1705008084,ERNEST,SHORE,12/17/1959,M,W <br/>


### first_name (correct: 4/5 groups, 4/10 pairs | wrong: 1 pair)

146_a,1000153844,KEVIN,RANDALL,08/31/1951,M,W <br/>
146_b,1001039939,KEVIN,PURCELL,08/31/1951,M, <br/>

223_a,1063209897,BAKRI,ABDEL-AZIZ SR,03/26/1965,M,O <br/>
223_b,1100128569,BAKRI,ABDEL-AZIZ SR,03/26/1915,M,O <br/>

223_bd,1100128569,BAKER,ABDEL-AZIZ SR,04/08/1982,M,O <br/>
333_b,1000295504,BAKER,MARY DELL,04/08/1928,F,W <br/>
333_bd,1000295504,BAKER,MARY DELL,04/08/1982,F,W <br/>

87_b,1705008084,ERNEST,SHORE III,12/17/1959,M,W <br/>
87_bd,1705008084,ERNEST,SHORE,12/17/1959,M,W <br/>


### last_name (correct: 4/5 groups, 5/10 pairs | wrong: 0 pairs)

223_a,1063209897,BAKRI,ABDEL-AZIZ SR,03/26/1965,M,O <br/>
223_b,1100128569,BAKRI,ABDEL-AZIZ SR,03/26/1915,M,O <br/>
223_bd,1100128569,BAKER,ABDEL-AZIZ SR,04/08/1982,M,O <br/>

333_b,1000295504,BAKER,MARY DELL,04/08/1928,F,W <br/>
333_bd,1000295504,BAKER,MARY DELL,04/08/1982,F,W <br/>

358_a,,W RICHARD,ARCILESI JR,01/30/1957,M,W <br/>
358_b,1015248678,WILLIAM,ARCILESI JR,01/30/1917,M,W <br/>

87_a,1075008084,ERNIE,SHORE III,12/17/1959,M,W <br/>
87_b,1705008084,ERNEST,SHORE III,12/17/1959,M,W <br/>

## Workflow

### Iteration 1: Blocking with last name
Let's say we block with last name. After first round of record linkage the file will become: 

ID,voter_reg_num,first_name,last_name,dob,sex,race,centroid,group,n <br/>
--groups-- <br/>
223_a,1063209897,BAKRI,ABDEL-AZIZ SR,03/26/1965,M,O,0,1,3 <br/>
223_b,1100128569,BAKRI,ABDEL-AZIZ SR,03/26/1915,M,O,1,1,3 <br/>
223_bd,1100128569,BAKER,ABDEL-AZIZ SR,04/08/1982,M,O,0,1,3 <br/>

333_b,1000295504,BAKER,MARY DELL,04/08/1928,F,W,1,2,2 <br/>
333_bd,1000295504,BAKER,MARY DELL,04/08/1982,F,W,0,2,2 <br/>

358_a,,W RICHARD,ARCILESI JR,01/30/1957,M,W,1,3,2 <br/>
358_b,1015248678,WILLIAM,ARCILESI JR,01/30/1917,M,W,0,3,2 <br/>

87_a,1075008084,ERNIE,SHORE III,12/17/1959,M,W,0,4,2 <br/>
87_b,1705008084,ERNEST,SHORE III,12/17/1959,M,W,1,4,2 <br/>

--singletons-- <br/>
146_a,1000153844,KEVIN,RANDALL,08/31/1951,M,W,1,5,1 <br/>

146_b,1001039939,KEVIN,PURCELL,08/31/1951,M,,1,6,1 <br/>

333_a,,MARY DELL,BAKER,04/08/1928,F,W,1,7,1 <br/>

87_bd,1705008084,ERNEST,SHORE,12/17/1959,M,W,1,8,1 <br/>


### Iteration 2: Blocking with voter registry number

Now for the second iteration of record linkage, let's assume for some reason we choose voter registry number as our blocking variable. The already grouped records will not be touched. The centroids alone will be considered for this round. For instance, 

223_b,1100128569,BAKRI,ABDEL-AZIZ SR,03/26/1915,M,O,1,1,3 <br/>
333_b,1000295504,BAKER,MARY DELL,04/08/1928,F,W,1,2,2 <br/>
358_a,,W RICHARD,ARCILESI JR,01/30/1957,M,W,1,3,2 <br/>
87_b,1705008084,ERNEST,SHORE III,12/17/1959,M,W,1,4,2 <br/>
146_a,1000153844,KEVIN,RANDALL,08/31/1951,M,W,1,5,1 <br/>
146_b,1001039939,KEVIN,PURCELL,08/31/1951,M,,1,6,1 <br/>
333_a,,MARY DELL,BAKER,04/08/1928,F,W,1,7,1 <br/>
87_bd,1705008084,ERNEST,SHORE,12/17/1959,M,W,1,8,1 <br/>

We can see that only records 358_a and 333_a have the same ID string (empty). When compared, the user will NOT call it the same becase they are very different. Hence after this round of rl with voter id, our file would be the exact same thing:

ID,voter_reg_num,first_name,last_name,dob,sex,race,centroid,group,n <br/>
--groups-- <br/>
223_a,1063209897,BAKRI,ABDEL-AZIZ SR,03/26/1965,M,O,0,1,3 <br/>
223_b,1100128569,BAKRI,ABDEL-AZIZ SR,03/26/1915,M,O,1,1,3 <br/>
223_bd,1100128569,BAKER,ABDEL-AZIZ SR,04/08/1982,M,O,0,1,3 <br/>

333_b,1000295504,BAKER,MARY DELL,04/08/1928,F,W,1,2,2 <br/>
333_bd,1000295504,BAKER,MARY DELL,04/08/1982,F,W,0,2,2 <br/>

358_a,,W RICHARD,ARCILESI JR,01/30/1957,M,W,1,3,2 <br/>
358_b,1015248678,WILLIAM,ARCILESI JR,01/30/1917,M,W,0,3,2 <br/>

87_a,1075008084,ERNIE,SHORE III,12/17/1959,M,W,0,4,2 <br/>
87_b,1705008084,ERNEST,SHORE III,12/17/1959,M,W,1,4,2 <br/>

--singletons-- <br/>
146_a,1000153844,KEVIN,RANDALL,08/31/1951,M,W,1,5,1 <br/>

146_b,1001039939,KEVIN,PURCELL,08/31/1951,M,,1,6,1 <br/>

333_a,,MARY DELL,BAKER,04/08/1928,F,W,1,7,1 <br/>

87_bd,1705008084,ERNEST,SHORE,12/17/1959,M,W,1,8,1 <br/>


### Iteration 3: Blocking with dob

Now we use dob as our blocking variable. Now we get 3 new comparisons among centroids. If the comparison is positive, we update the 

- centroids (if group != min(group), centroid = 0)
- groups (group = min(group))

As per these rules, we update 333 and 87 but not 146. 

333_a,,MARY DELL,BAKER,04/08/1928,F,W,0,2,1 <br/>
333_b,1000295504,BAKER,MARY DELL,04/08/1928,F,W,1,2,2 <br/>

146_a,1000153844,KEVIN,RANDALL,08/31/1951,M,W,1,5,1 <br/>
146_b,1001039939,KEVIN,PURCELL,08/31/1951,M,,1,6,1 <br/>

87_b,1705008084,ERNEST,SHORE III,12/17/1959,M,W,1,4,2 <br/>
87_bd,1705008084,ERNEST,SHORE,12/17/1959,M,W,0,4,1  <br/>

Finally, we update the n of each group. So the new output file would be:

ID,voter_reg_num,first_name,last_name,dob,sex,race,centroid,group,n <br/>
--groups-- <br/>
223_a,1063209897,BAKRI,ABDEL-AZIZ SR,03/26/1965,M,O,0,1,3 <br/>
223_b,1100128569,BAKRI,ABDEL-AZIZ SR,03/26/1915,M,O,1,1,3 <br/>
223_bd,1100128569,BAKER,ABDEL-AZIZ SR,04/08/1982,M,O,0,1,3 <br/>

333_a,,MARY DELL,BAKER,04/08/1928,F,W,0,2,3 <br/>
333_b,1000295504,BAKER,MARY DELL,04/08/1928,F,W,1,2,3 <br/>
333_bd,1000295504,BAKER,MARY DELL,04/08/1982,F,W,0,2,3 <br/>

358_a,,W RICHARD,ARCILESI JR,01/30/1957,M,W,1,3,2 <br/>
358_b,1015248678,WILLIAM,ARCILESI JR,01/30/1917,M,W,0,3,2 <br/>

87_a,1075008084,ERNIE,SHORE III,12/17/1959,M,W,0,4,3 <br/>
87_b,1705008084,ERNEST,SHORE III,12/17/1959,M,W,1,4,3 <br/>
87_bd,1705008084,ERNEST,SHORE,12/17/1959,M,W,0,4,3 <br/>

--singletons-- <br/>
146_a,1000153844,KEVIN,RANDALL,08/31/1951,M,W,1,5,1 <br/>
146_b,1001039939,KEVIN,PURCELL,08/31/1951,M,,1,6,1 <br/>

Even if we had started with out ideal grouping comparisons, we would have arrived at the same answers. By iteratively blocking, we try to achieve the same performance (comparison 146's answer is 0)


## Note

- pick centroid based on how common it is rather than random?.  (87 and 358)
- if we block on a new var in an iteration and the matching record in another group is not a centroid?
- singletons to the last

























# Unusable groups

## sample 2

### sex (grouping too big)

146_a,1000153844,KEVIN,RANDALL,08/31/1951,M,W
146_b,1001039939,KEVIN,PURCELL,08/31/1951,M,

223_a,1063209897,BAKRI,ABDEL-AZIZ SR,03/26/1965,M,O
223_b,1100128569,BAKRI,ABDEL-AZIZ SR,03/26/1915,M,O
223_bd,1100128569,BAKER,ABDEL-AZIZ SR,04/08/1982,M,O

333_a,,MARY DELL,BAKER,04/08/1928,F,W
333_b,1000295504,BAKER,MARY DELL,04/08/1928,F,W
333_bd,1000295504,BAKER,MARY DELL,04/08/1982,F,W

358_a,,W RICHARD,ARCILESI JR,01/30/1957,M,W
358_b,1015248678,WILLIAM,ARCILESI JR,01/30/1917,M,W

87_a,1075008084,ERNIE,SHORE III,12/17/1959,M,W
87_b,1705008084,ERNEST,SHORE III,12/17/1959,M,W
87_bd,1705008084,ERNEST,SHORE,12/17/1959,M,W

### race (grouping too big)

146_a,1000153844,KEVIN,RANDALL,08/31/1951,M,W
146_b,1001039939,KEVIN,PURCELL,08/31/1951,M,

223_a,1063209897,BAKRI,ABDEL-AZIZ SR,03/26/1965,M,O
223_b,1100128569,BAKRI,ABDEL-AZIZ SR,03/26/1915,M,O
223_bd,1100128569,BAKER,ABDEL-AZIZ SR,04/08/1982,M,O

333_a,,MARY DELL,BAKER,04/08/1928,F,W
333_b,1000295504,BAKER,MARY DELL,04/08/1928,F,W
333_bd,1000295504,BAKER,MARY DELL,04/08/1982,F,W

358_a,,W RICHARD,ARCILESI JR,01/30/1957,M,W
358_b,1015248678,WILLIAM,ARCILESI JR,01/30/1917,M,W

87_a,1075008084,ERNIE,SHORE III,12/17/1959,M,W
87_b,1705008084,ERNEST,SHORE III,12/17/1959,M,W
87_bd,1705008084,ERNEST,SHORE,12/17/1959,M,W

### date (correct: 3/5 groups, 4/10 pairs | wrong: 0 pairs)


146_a,1000153844,KEVIN,RANDALL,08/31/1951,M,W
146_b,1001039939,KEVIN,PURCELL,08/31/1951,M,

223_a,1063209897,BAKRI,ABDEL-AZIZ SR,03/26/1965,M,O
223_b,1100128569,BAKRI,ABDEL-AZIZ SR,03/26/1915,M,O
223_bd,1100128569,BAKER,ABDEL-AZIZ SR,04/08/1982,M,O

333_a,,MARY DELL,BAKER,04/08/1928,F,W
333_b,1000295504,BAKER,MARY DELL,04/08/1928,F,W
333_bd,1000295504,BAKER,MARY DELL,04/08/1982,F,W

358_a,,W RICHARD,ARCILESI JR,01/30/1957,M,W
358_b,1015248678,WILLIAM,ARCILESI JR,01/30/1917,M,W

87_a,1075008084,ERNIE,SHORE III,12/17/1959,M,W
87_b,1705008084,ERNEST,SHORE III,12/17/1959,M,W
87_bd,1705008084,ERNEST,SHORE,12/17/1959,M,W